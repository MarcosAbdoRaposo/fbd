<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Usuários - CRUD</title>
    <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 30px auto;
    }

    input,
    button {
      margin: 5px 0;
      padding: 6px;
      width: 100%;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th,
    td {
      padding: 8px;
      border: 1px solid #ccc;
      text-align: left;
    }

    .actions {
      display: flex;
      gap: 10px;
    }

    /* Define o contêiner como um layout flexível */
    .container-botoes {
        display: flex;
        /* Adiciona um espaço entre os botões */
        gap: 10px; 
        /* Opcional: Centraliza os botões no contêiner */
        justify-content: center; 
    }
    .header-com-botao {
        /* 1. Ativa o Flexbox para alinhar os itens na mesma linha */
        display: flex;
        
        /* 2. Alinha verticalmente os itens no centro (útil se o botão for menor que o H2) */
        align-items: center; 
        
        /* 3. Distribui o espaço disponível entre e ao redor dos itens. */
        /* 'space-between' empurra o H2 para a esquerda e o botão para a direita */
        justify-content: space-between; 
        
        /* Opcional: Para visualizar o contêiner */
        /* border-bottom: 1px solid #ccc; */
        padding-bottom: 10px;
    }
  </style>

</head>
<body>

  <h1>Cadastro de Animais</h1>

  <div id="areaEdicao" hidden>
 <!-- <form id="animalForm"> -->
    <input type="hidden" id="id" />

    <label for="codigo_lacre">codigo_lacre:</label><br>
    <input type="text" id="codigo_lacre" placeholder="Código do Lacre" required/>

    <label for="nome_animal">Endereço:</label><br>
    <input type="text" id="nome_animal" placeholder="Endereço"/>

    <label for="codigo_registro">Código do Registro:</label><br>
    <input type="text" id="codigo_registro" placeholder="Código do Registro"  />

    <label for="codigo_registro_pai">Código do Registro Pai:</label><br>
    <input type="text" id="codigo_registro_pai" placeholder="Código do Registro Pai" />

    <label for="codigo_registro_mae">Código do Registro da Mãe:</label><br>
    <input type="text" id="codigo_registro_mae" placeholder="Código do Registro da Mãe" />

    <label for="peso_inicial">Peso Inicial:</label><br>
    <input type="text" id="peso_inicial" placeholder="Peso Inicial" />

        
    <label for="data_nascimento">Data de Nascimento:</label><br>
    <input type="text" id="data_nascimento" placeholder="Data de Nascimento" />


    <div class="container-botoes">
        <!-- <button type="submit">Salvar</button> -->

        <button onclick="salvarAnimal(1)">Salvar</button>
        <button onclick="ocultarFormulario()">Cancelar</button>
    </div>
   <!-- </form> -->
  </div>

  <div id="areaLista">
    <div class="header-com-botao">
        <h2>Lista Completa de Animais</h2>
        <button id="btnteste" onclick="novoAnimal()">Inclusão</button>
    </div>
  
  <table id=>
    <thead>
      <tr>
        <th>Código do Lacre</th>
        <th>Nome do Animal</th>
        <th>Código do Registro</th>
        <th>Data de Nascimento</th>
        <th>Ações</th>
      </tr>
    </thead>
    <tbody id="clientTable"></tbody>
  </table>
  </div>
  


  

  <script>
      const API_URL = "http://localhost:3000/animais";

      async function carregarAnimais() {
          const res = await fetch(API_URL);
          const animais = await res.json();
          const tabela = document.getElementById("clientTable");
          tabela.innerHTML = "";

          animais.forEach(animal => {
          const row = document.createElement("tr");
          row.innerHTML = `
              <td>${animal.codigo_lacre}</td>
              <td>${animal.nome_animal}</td>
              <td>${animal.codigo_registro}</td>
              <td>${animal.data_nascimento}</td>
              <td class="actions">
              <button onclick="editarAnimal(${animal.id})">Editar</button>
              <button onclick="excluirAnimal(${animal.id})">Excluir</button>
              </td>
          `;
          tabela.appendChild(row);
          });
      }

      async function salvarAnimal(e) {
          if (criticaAnimal()) {
          
            //e.preventDefault();

            // Cria json com os dados a seren enviados

            const id = document.getElementById("id").value;
            const data = {
            codigo_lacre: document.getElementById("codigo_lacre").value,
            nome_animal: document.getElementById("nome_animal").value,
            codigo_registro: document.getElementById("codigo_registro").value,
            codigo_registro_pai: document.getElementById("codigo_registro_pai").value,
            codigo_registro_mae: document.getElementById("codigo_registro_mae").value,
            peso_inicial: document.getElementById("peso_inicial").value,
            data_nascimento:document.getElementById("data_nascimento").value,

            };

            // se existir id então é atualização, senão inclusão
            // Post inserir 
            // Put Atualizar 

            let metodo = ""
            let url = ""
            if (id > 0){
                metodo = "PUT"
                url = `${API_URL}/${id}` 
            } else {
                metodo = "POST"
                url =  API_URL;
            }
            //const metodo = id ? "PUT" : "POST";
            //const url = id ? `${API_URL}/${id}` : API_URL;

            console.log(`id:${id}`)
            console.log(`metodo:${metodo}`)
            
            await fetch(url, {
            method: metodo,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
            });

            // document.getElementById("animalForm").reset();

            // Recarrega a Grade a tela
            ocultarFormulario();
            carregarAnimais();
       }
      }

      async function editarAnimal(id) {

          // Obtem os dados de um determinado animal
          const res = await fetch(`${API_URL}/${id}`, { method: "GET" });
          const animal = await res.json();

          document.getElementById("id").value = id;
          document.getElementById("codigo_lacre").value = animal.codigo_lacre;
          document.getElementById("nome_animal").value = animal.nome_animal;
          document.getElementById("codigo_registro").value = animal.codigo_registro;
          document.getElementById("codigo_registro_pai").value = animal.codigo_registro_pai;
          document.getElementById("codigo_registro_mae").value = animal.codigo_registro_mae;
          document.getElementById("peso_inicial").value = animal.peso_inicial;
          document.getElementById("data_nascimento").value = animal.data_nascimento;

          exibirFormulario()



      }

      async function excluirAnimal(id) {
          if (confirm("Deseja excluir este animal?")) {
          await fetch(`${API_URL}/${id}`, { method: "DELETE" });
          carregarAnimais();
          }
      }

      function exibirFormulario() {

        document.getElementById("areaEdicao").hidden = false
        document.getElementById("areaLista").hidden = true
      }

      function ocultarFormulario() {
        document.getElementById("areaEdicao").hidden = true
        document.getElementById("areaLista").hidden = false
      }

      function limparCamposFormulario() {
          document.getElementById("id").value = 0;
          document.getElementById("codigo_lacre").value = "";
          document.getElementById("nome_animal").value = "";
          document.getElementById("codigo_registro").value = "";
          document.getElementById("codigo_registro_pai").value = "";
          document.getElementById("codigo_registro_mae").value = "";
          document.getElementById("peso_inicial").value = "";
          document.getElementById("data_nascimento").value = "";

      }

      function novoAnimal() {
        limparCamposFormulario();
        document.getElementById("id").value = 0;
        exibirFormulario();
      }

      function criticaAnimal() {
          if (document.getElementById("codigo_lacre").value == "") {
            alert("Código do Lacre do Animal não fornecido.");
            return false;
          }
          if (document.getElementById("nome_animal").value == "") {
            alert("Nome do Animal não fornecido.");
            return false;
          }
          
          if (document.getElementById("codigo_registro").value == "") {
            alert("Código do Registro do Animal não fornecido.");
            return false;
          };
          if (document.getElementById("codigo_registro_pai").value == "") {
            alert("Código do Registro Pai do Animal não fornecido.");
            return false;
          };
          if (document.getElementById("codigo_registro_mae").value == "") {
            alert("Código do Registro da Mãe do Animal não fornecido.");
            return false;
          };
          if (document.getElementById("peso_inicial").value == "") {
            alert("Peso Inicial do Animal não fornecido.");
            return false;
          };
          if (document.getElementById("data_nascimento").value == "") {
            alert("Data de Nascimento do Animal não fornecida.");
            return false;
          };

          return true;

      }

      //document.getElementById("animalForm").addEventListener("submit", salvarAnimal);
      carregarAnimais();


  </script> 
  

</body>
</html>